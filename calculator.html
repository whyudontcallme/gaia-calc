<div id="waste-calculator-gaia" style="
  max-width: 680px;
  margin: 3rem auto;
  padding: 2rem;
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.6);
  font-family: 'Manrope', system-ui, sans-serif;
  color: #222;
">
  <h3 style="
    font-weight: 700;
    font-size: 24px;
    text-align: center;
    margin: 0 0 1.5rem;
    color: #2E8B57;
  ">Рассчитайте вашу экономию</h3>

  <div style="display: flex; gap: 16px; margin-bottom: 1.5rem; flex-wrap: wrap;">
    <label style="flex: 1; min-width: 180px;">
      <input type="radio" name="calc-type" value="electric" checked style="margin-right: 8px;">
      Электрическая
    </label>
    <label style="flex: 1; min-width: 180px;">
      <input type="radio" name="calc-type" value="gas" style="margin-right: 8px;">
      Газовая
    </label>
  </div>

  <div style="display: grid; gap: 16px; margin-bottom: 1.2rem;">

    <div>
      <label style="display: block; font-size: 14px; margin-bottom: 6px; color: #555;">Объём отходов в сутки</label>
      <div style="display: flex; gap: 8px;">
        <input type="number" id="waste-amount" placeholder="300" min="0" step="10"
          style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px;">
        <select id="waste-unit"
          style="padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px;">
          <option value="kg">кг/сут</option>
          <option value="t">т/сут</option>
        </select>
      </div>
    </div>

    <div>
      <label style="display: block; font-size: 14px; margin-bottom: 6px; color: #555;">Текущие расходы на утилизацию (руб/сут)</label>
      <input type="number" id="current-cost" placeholder="5000" value="0" min="0"
        style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px;">
    </div>

    <div id="energy-cost-label">
      <label style="display: block; font-size: 14px; margin-bottom: 6px; color: #555;">Стоимость электроэнергии (руб/кВт·ч)</label>
      <input type="number" id="energy-cost" placeholder="10" value="10" min="0" step="0.1"
        style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px;">
    </div>

  </div>

  <button onclick="window.calculateWasteGaia()" style="
    width: 100%;
    padding: 12px;
    background: #2E8B57;
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.2s;
  " onmouseover="this.style.background='#257a4a'" onmouseout="this.style.background='#2E8B57'">
    Рассчитать экономию
  </button>

  <div id="calc-result" style="
    margin-top: 1.5rem;
    padding: 1.2rem;
    background: rgba(46, 139, 87, 0.06);
    border-radius: 16px;
    display: none;
    font-size: 15px;
    line-height: 1.5;
    color: #222;
  "></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  if (window.calculateWasteGaia) return;

  const electricData = [
    { prod: 50, cons: 40 }, { prod: 100, cons: 100 }, { prod: 150, cons: 120 },
    { prod: 200, cons: 160 }, { prod: 300, cons: 240 }, { prod: 400, cons: 320 },
    { prod: 600, cons: 480 }, { prod: 1000, cons: 800 }, { prod: 1200, cons: 960 },
    { prod: 2000, cons: 1600 }
  ];

  const gasDataKg = [
    { prod: 1000, cons: 100 }, { prod: 1200, cons: 120 }, { prod: 2000, cons: 200 },
    { prod: 5000, cons: 500 }, { prod: 10000, cons: 1000 }, { prod: 20000, cons: 2000 },
    { prod: 50000, cons: 5000 }, { prod: 100000, cons: 10000 }, { prod: 200000, cons: 20000 },
    { prod: 300000, cons: 30000 }
  ];

  function findClosest(data, amount) {
    const suitable = data.filter(d => d.prod >= amount);
    return suitable.length ? suitable[0] : data[data.length - 1];
  }

  window.calculateWasteGaia = function() {
    const type = document.querySelector('input[name="calc-type"]:checked').value;
    let amount = parseFloat(document.getElementById('waste-amount').value);
    const currentCost = parseFloat(document.getElementById('current-cost').value) || 0;
    const energyPrice = parseFloat(document.getElementById('energy-cost').value) || 0;
    const unit = document.getElementById('waste-unit').value;

    if (isNaN(amount) || amount <= 0) {
      alert('Пожалуйста, укажите объём отходов');
      return;
    }

    if (unit === 't') amount *= 1000;

    let dataRow, energyName, energyUnit;
    if (type === 'electric') {
      dataRow = findClosest(electricData, amount);
      energyName = 'электроэнергии';
      energyUnit = 'кВт·ч';
    } else {
      dataRow = findClosest(gasDataKg, amount);
      energyName = 'газа';
      energyUnit = 'м³';
    }

    const consDay = dataRow.cons;
    const consHour = consDay / 24;
    const dailyEnergyCost = consDay * energyPrice;
    const dailySavings = currentCost - dailyEnergyCost;
    const yearlySavings = dailySavings * 365;

    const resDiv = document.getElementById('calc-result');
    resDiv.innerHTML = `
      <div style="margin-bottom: 8px;"><strong>Подобрано оборудование:</strong> ${amount.toLocaleString()} кг/сут</div>
      <div style="margin-bottom: 8px;">Потребление ${energyName}: ${consDay} ${energyUnit}/сут (${consHour.toFixed(2)} ${energyUnit}/ч)</div>
      <div style="margin-bottom: 8px;">Стоимость энергии: <strong>${dailyEnergyCost.toLocaleString()} ₽/сут</strong></div>
      <div style="margin-bottom: 12px;">Ваши текущие расходы: <strong>${currentCost.toLocaleString()} ₽/сут</strong></div>
      
      <div style="padding: 10px; background: white; border-radius: 10px; margin-top: 10px;">
        <div>Ежедневная экономия: <strong style="color: ${dailySavings >= 0 ? '#2E8B57' : '#d32f2f'}">${dailySavings >= 0 ? '+' : ''}${dailySavings.toLocaleString()} ₽/сут</strong></div>
        <div>Годовая экономия: <strong style="color: ${yearlySavings >= 0 ? '#2E8B57' : '#d32f2f'}">${yearlySavings >= 0 ? '+' : ''}${yearlySavings.toLocaleString()} ₽/год</strong></div>
      </div>
    `;
    resDiv.style.display = 'block';
  };

  document.querySelectorAll('input[name="calc-type"]').forEach(radio => {
    radio.addEventListener('change', () => {
      const labelWrap = document.getElementById('energy-cost-label');
      if (radio.value === 'electric') {
        labelWrap.innerHTML = `
          <label style="display: block; font-size: 14px; margin-bottom: 6px; color: #555;">Стоимость электроэнергии (руб/кВт·ч)</label>
          <input type="number" id="energy-cost" placeholder="10" value="10" min="0" step="0.1"
            style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px;">
        `;
      } else {
        labelWrap.innerHTML = `
          <label style="display: block; font-size: 14px; margin-bottom: 6px; color: #555;">Стоимость газа (руб/м³)</label>
          <input type="number" id="energy-cost" placeholder="10" value="10" min="0" step="0.1"
            style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px;">
        `;
      }
    });
  });
});
</script>